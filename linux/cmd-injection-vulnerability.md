# Command Injection Vulnerability

<!-- tl;dr starts -->

**TL;DR:**

<!-- tl;dr ends -->

## Problem

List all the files and directories inside current working directory using `find -exec sh -c`

```sh
find . -maxdepth 1 -exec sh -c 'echo {}' \;
```

Embed `{}` in the shell code will create a command injection vulnerability if a file is named something like `;echo malicious`

Some people said put double quotes around it is safe but there are ways to bypass that also.

## Solution

Pass the file names as separate arguments to `sh -c`

```sh
find . -maxdepth 1 -exec sh -c 'echo "$1"' _ {} \;

# _ will be inline script $0, it's better if you use something relevant like inline-sh, find-sh, ... since $0 will be displayed in the shell's err message
# {} will be $1
```

Doing this not only makes it more secure but also grants you the power of [Parameter Expansion](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_02)

> **CAUTION**: `sh -c` doesn't play nicely with GNU `parallel`.

## References

- [St√©phane Chazelas's answer on StackExchange](https://unix.stackexchange.com/a/156010)
